-- Создание таблицы пользователей
CREATE TABLE IF NOT EXISTS projects (
    id SERIAL PRIMARY KEY,
    project_id VARCHAR(50) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Создание таблицы моделей
CREATE TABLE IF NOT EXISTS models (
    id SERIAL PRIMARY KEY,
    article VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Создание таблицы сессий
CREATE TABLE IF NOT EXISTS sessions (
    project_id INTEGER REFERENCES projects(id) UNIQUE,
    session_data JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Добавляем комментарии
COMMENT ON TABLE sessions IS 'Таблица для хранения сессий пользователей';
COMMENT ON COLUMN sessions.session_data IS 'JSON данные сессии, включая размещенные модели и их координаты'; 

-- Создание индексов для оптимизации запросов
CREATE INDEX IF NOT EXISTS idx_models_name ON models(name);
CREATE INDEX IF NOT EXISTS idx_models_category ON models(category);

-- Добавление комментариев к таблицам
COMMENT ON TABLE projects IS 'Таблица проектов';
COMMENT ON TABLE models IS 'Таблица моделей игрового оборудования';
COMMENT ON TABLE sessions IS 'Таблица сессий, связывающая пользователей и модели';

-- Добавление комментариев к колонкам
COMMENT ON COLUMN projects.project_id IS 'Уникальный идентификатор проекта';
COMMENT ON COLUMN models.article IS 'Артикул модели';
COMMENT ON COLUMN models.name IS 'Название модели';
COMMENT ON COLUMN models.description IS 'Описание модели';
COMMENT ON COLUMN models.category IS 'Категория модели';

-- Вставка тестового проекта
INSERT INTO projects (project_id) 
VALUES ('id_12345678')
ON CONFLICT (project_id) DO NOTHING;

-- Вставка моделей
INSERT INTO models (article, name, description, category) VALUES
    ('ЛГД-19', 'ЛГД-19 Домик Белочка (TE319)', 'Детский игровой домик "Белочка"', 'Домики'),
    ('ЛГК-24.7', 'ЛГК-24.7 Качалка на пружине Рыбка', 'Качалка на пружине "Рыбка"', 'Качалки'),
    ('ЛГИК-7.26', 'ЛГИК-7.26 Игровой комплекс Весна-6 (TE706)', 'Игровой комплекс "Весна-6"', 'Комплексы'),
    ('ЛГИК-7.03', 'ЛГИК-7.03 Игровой комплекс Черепашка (TE703)', 'Игровой комплекс "Черепашка"', 'Комплексы'),
    ('ЛГИК-7.01', 'ЛГИК-7.01 Игровой комплекс Весна (TE701)', 'Игровой комплекс "Весна"', 'Комплексы'),
    ('ЛГД-29', 'ЛГД-29 Домик Спускаемый модуль (1384)', 'Детский игровой домик "Спускаемый модуль"', 'Домики'),
    ('ЛГД-25', 'ЛГД-25 Домик Вертолет (3701.2)', 'Детский игровой домик "Вертолет"', 'Домики'),
    ('ЛГД-23', 'ЛГД-23 Домик Деревня (TE323)', 'Детский игровой домик "Деревня"', 'Домики'),
    ('ЛГД-14', 'ЛГД-14 Беседка Хижина (1364)', 'Детская беседка "Хижина"', 'Беседки'),
    ('ЛГВО-421', 'ЛГВО-421 Спортивный комплекс ЛГВО-421 (Нержавеющая сталь) (2279.50)', 'Спортивный комплекс из нержавеющей стали', 'Спортивные комплексы')
ON CONFLICT (article) DO UPDATE 
SET name = EXCLUDED.name,
    description = EXCLUDED.description,
    category = EXCLUDED.category;

-- Вставка моделей из GLB файлов
INSERT INTO models (article, name, description, category) VALUES
    ('ЛГИК-02.01', 'ЛГИК-02.01 Игровой комплекс Рёло 02.01', 'Игровой комплекс Рёло 02.01', 'Комплексы'),
    ('ЛГИК-02.18', 'ЛГИК-02.18 Игровой комплекс Рёло 02.18', 'Игровой комплекс Рёло 02.18', 'Комплексы'),
    ('ЛГИК-02.17-1', 'ЛГИК-02.17-1 Игровой комплекс Рёло', 'Игровой комплекс Рёло', 'Комплексы'),
    ('ЛГИК-02.17', 'ЛГИК-02.17 Игровой комплекс Рёло 02.17', 'Игровой комплекс Рёло 02.17', 'Комплексы'),
    ('ЛГИК-02.16', 'ЛГИК-02.16 Игровой комплекс Рёло 02.16', 'Игровой комплекс Рёло 02.16', 'Комплексы'),
    ('ЛГИК-02.14', 'ЛГИК-02.14 Игровой комплекс Рёло 02.14', 'Игровой комплекс Рёло 02.14', 'Комплексы'),
    ('ЛГИК-02.13', 'ЛГИК-02.13 Игровой комплекс Рёло 02.13', 'Игровой комплекс Рёло 02.13', 'Комплексы'),
    ('ЛГИК-02.12', 'ЛГИК-02.12 Игровой комплекс Рёло 02.12', 'Игровой комплекс Рёло 02.12', 'Комплексы'),
    ('ЛГИК-02.11', 'ЛГИК-02.11 Игровой комплекс Рёло 02.11', 'Игровой комплекс Рёло 02.11', 'Комплексы'),
    ('ЛГИК-02.04', 'ЛГИК-02.04 Игровой комплекс Рёло 02.04', 'Игровой комплекс Рёло 02.04', 'Комплексы'),
    ('ЛГИК-02.03', 'ЛГИК-02.03 Игровой комплекс Рёло 02.03', 'Игровой комплекс Рёло 02.03', 'Комплексы'),
    ('ЛГИК-02.02', 'ЛГИК-02.02 Игровой комплекс Рёло 02.02', 'Игровой комплекс Рёло 02.02', 'Комплексы'),
    ('ЛГД-16.06', 'ЛГД-16.06 Домик Бриум 16.06', 'Домик Бриум 16.06', 'Домики'),
    ('ЛГИК-16.01', 'ЛГИК-16.01 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.02', 'ЛГИК-16.02 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.03', 'ЛГИК-16.03 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.04', 'ЛГИК-16.04 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.05', 'ЛГИК-16.05 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.10', 'ЛГИК-16.10 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.11', 'ЛГИК-16.11 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.12', 'ЛГИК-16.12 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.13', 'ЛГИК-16.13 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.14', 'ЛГИК-16.14 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы'),
    ('ЛГИК-16.15', 'ЛГИК-16.15 Игровой комплекс Бриум', 'Игровой комплекс Бриум', 'Комплексы')
ON CONFLICT (article) DO UPDATE 
SET name = EXCLUDED.name,
    description = EXCLUDED.description,
    category = EXCLUDED.category;